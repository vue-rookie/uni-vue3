<template>
  <view class="min-h-screen bg-white">
    <!-- èƒŒæ™¯å›¾ -->
    <view class="relative">
      <view class="absolute inset-0 bg-gradient-to-b from-blue-400 to-blue-600"></view>

      <!-- é¡¶éƒ¨æ“ä½œæ  -->
      <view class="pt-12 px-4 pb-4 flex justify-between items-center relative z-10">
        <view class="flex items-center space-x-4">
          <view
            class="w-10 h-10 bg-black bg-opacity-20 rounded-full flex items-center justify-center"
          >
            <text class="i-ri-user-add-line text-white text-xl"></text>
          </view>
          <text class="text-white text-base">æ·»åŠ æœ‹å‹</text>
        </view>
        <view class="flex items-center space-x-4">
          <view
            class="w-10 h-10 bg-black bg-opacity-20 rounded-full flex items-center justify-center"
          >
            <text class="i-ri-search-line text-white text-xl"></text>
          </view>
          <view
            class="w-10 h-10 bg-black bg-opacity-20 rounded-full flex items-center justify-center"
          >
            <text class="i-ri-menu-line text-white text-xl"></text>
          </view>
        </view>
      </view>

      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="px-4 pb-8 relative z-10">
        <!-- å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="flex items-center mb-6">
          <image
            src="https://cdn.pixabay.com/photo/2017/11/06/13/45/cap-2923682_1280.jpg"
            class="w-20 h-20 rounded-full border-2 border-white mr-4"
            mode="aspectFill"
          ></image>
          <view>
            <view class="flex items-center">
              <text class="text-white text-xl font-medium mr-2">åº†å€¦äº†åŸå¸‚</text>
              <view class="bg-red-500 rounded-md px-1 py-0.5 flex items-center">
                <text class="text-white text-xs">20</text>
              </view>
            </view>
            <text class="text-white text-sm opacity-80">æŠ–éŸ³å·ï¼š959321199 ğŸ”—</text>
          </view>
        </view>

        <!-- ä¸ªäººç®€ä»‹ -->
        <view class="mb-6">
          <text class="text-white text-base">ä¿æŒå¿ƒåº•å–„è‰¯ï¼Œå¯æŠµå²æœˆæ¼«é•¿!</text>
        </view>

        <!-- åœ°åŒºå’Œå¹´é¾„ -->
        <view class="flex items-center space-x-3 mb-6">
          <view class="bg-black bg-opacity-20 rounded-md px-2 py-1">
            <text class="text-white text-xs">å±±è¥¿Â·å¤ªåŸ</text>
          </view>
          <view class="bg-black bg-opacity-20 rounded-md px-2 py-1">
            <text class="text-white text-xs">ç”·Â·32å²</text>
          </view>
        </view>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <view class="flex items-center justify-between mb-6">
          <view class="text-center">
            <text class="text-white text-lg font-medium block">3115</text>
            <text class="text-white text-xs opacity-80">è·èµ</text>
          </view>
          <view class="text-center">
            <text class="text-white text-lg font-medium block">70</text>
            <text class="text-white text-xs opacity-80">äº’å…³</text>
          </view>
          <view class="text-center">
            <text class="text-white text-lg font-medium block">692</text>
            <text class="text-white text-xs opacity-80">å…³æ³¨</text>
          </view>
          <view class="text-center">
            <text class="text-white text-lg font-medium block">199</text>
            <text class="text-white text-xs opacity-80">ç²‰ä¸</text>
          </view>
        </view>

        <!-- ç¼–è¾‘æŒ‰é’® -->
        <view class="bg-white bg-opacity-20 rounded-md py-2 flex items-center justify-center">
          <text class="text-white text-base">ç¼–è¾‘ä¸»é¡µ</text>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="flex justify-between items-center px-8 py-4 border-b border-gray-100">
      <view class="flex flex-col items-center">
        <text class="i-ri-shopping-cart-line text-gray-700 text-2xl mb-1"></text>
        <text class="text-xs text-gray-600">æˆ‘çš„è®¢å•</text>
      </view>
      <view class="flex flex-col items-center">
        <text class="i-ri-time-line text-gray-700 text-2xl mb-1"></text>
        <text class="text-xs text-gray-600">è§‚çœ‹å†å²</text>
      </view>
      <view class="flex flex-col items-center">
        <text class="i-ri-wallet-3-line text-gray-700 text-2xl mb-1"></text>
        <text class="text-xs text-gray-600">æˆ‘çš„é’±åŒ…</text>
      </view>
      <view class="flex flex-col items-center">
        <text class="i-ri-user-line text-gray-700 text-2xl mb-1"></text>
        <text class="text-xs text-gray-600">å¸¸è®¿é—®çš„äºº</text>
      </view>
      <view class="flex flex-col items-center">
        <text class="i-ri-apps-line text-gray-700 text-2xl mb-1"></text>
        <text class="text-xs text-gray-600">å…¨éƒ¨åŠŸèƒ½</text>
      </view>
    </view>

    <!-- å†…å®¹æ ‡ç­¾é¡µ -->
    <uve-tabs
      :items="tabItems"
      :custom-item-class="'flex-1'"
      :custom-line-class="'bg-gray-900'"
      :custom-content-class="'h-[calc(100vh-430px)]'"
      @change="handleTabChange"
    >
      <!-- ä½œå“æ ‡ç­¾å†…å®¹ -->
      <template #content-0>
        <scroll-view scroll-y class="h-full">
          <!-- ç§å¯†ä½œå“ -->
          <view class="p-4 border-b border-gray-100" @click="navigateToPrivateWorks">
            <view class="flex items-center justify-between">
              <view class="flex items-center">
                <text class="i-ri-lock-line text-gray-500 mr-2"></text>
                <text class="text-gray-800">ç§å¯†ä½œå“</text>
              </view>
              <view class="flex items-center">
                <text class="text-gray-400 mr-1">26</text>
                <text class="i-ri-arrow-right-s-line text-gray-400"></text>
              </view>
            </view>
          </view>

          <!-- è‰ç¨¿ç®± -->
          <view class="p-4 border-b border-gray-100" @click="navigateToDrafts">
            <view class="flex items-center justify-between">
              <view class="flex items-center">
                <text class="i-ri-draft-line text-gray-500 mr-2"></text>
                <text class="text-gray-800">è‰ç¨¿ç®±</text>
              </view>
              <view class="flex items-center">
                <text class="text-gray-400 mr-1">8</text>
                <text class="i-ri-arrow-right-s-line text-gray-400"></text>
              </view>
            </view>
          </view>

          <!-- ä½œå“åˆ—è¡¨ -->
          <view class="grid grid-cols-3 gap-px bg-gray-100">
            <view
              v-for="(work, index) in works"
              :key="index"
              class="aspect-square relative bg-gray-200"
              @click="openVideoDetail(work)"
            >
              <image :src="work.cover" class="w-full h-full object-cover" mode="aspectFill"></image>

              <!-- è§†é¢‘ä¿¡æ¯ -->
              <view class="absolute bottom-1 left-1 flex items-center">
                <text class="i-ri-play-fill text-white text-xs mr-1"></text>
                <text class="text-white text-xs">{{ formatCount(work.views) }}</text>
              </view>

              <!-- AIæ ‡ç­¾ -->
              <view
                v-if="work.isAI"
                class="absolute top-1 left-1 bg-black bg-opacity-50 rounded px-1"
              >
                <text class="text-white text-xs">AI å·²å®Œæˆ</text>
              </view>

              <!-- åœ°ç‚¹æ ‡ç­¾ -->
              <view v-if="work.location" class="absolute bottom-1 right-1">
                <text class="text-white text-xs">{{ work.location }}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </template>

      <!-- æ—¥å¸¸æ ‡ç­¾å†…å®¹ -->
      <template #content-1>
        <scroll-view scroll-y class="h-full">
          <view class="flex items-center justify-center h-full">
            <text class="text-gray-400">æš‚æ— æ—¥å¸¸å†…å®¹</text>
          </view>
        </scroll-view>
      </template>

      <!-- æ¨èæ ‡ç­¾å†…å®¹ -->
      <template #content-2>
        <scroll-view scroll-y class="h-full">
          <view class="flex items-center justify-center h-full">
            <text class="text-gray-400">æš‚æ— æ¨èå†…å®¹</text>
          </view>
        </scroll-view>
      </template>

      <!-- æ”¶è—æ ‡ç­¾å†…å®¹ -->
      <template #content-3>
        <scroll-view scroll-y class="h-full">
          <view class="flex items-center justify-center h-full">
            <text class="text-gray-400">æš‚æ— æ”¶è—å†…å®¹</text>
          </view>
        </scroll-view>
      </template>

      <!-- å–œæ¬¢æ ‡ç­¾å†…å®¹ -->
      <template #content-4>
        <scroll-view scroll-y class="h-full">
          <view class="flex items-center justify-center h-full">
            <text class="text-gray-400">æš‚æ— å–œæ¬¢å†…å®¹</text>
          </view>
        </scroll-view>
      </template>
    </uve-tabs>
  </view>

  <!-- è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ  -->
  <uve-tabbar :current="4" :tab-list="tabList" @change="handleTabbarChange" />
</template>

<script setup lang="ts">
import { ref } from "vue"
import UveTabbar from "@/components/uve-tabbar/index.vue"
import { defaultTabList, type TabItem } from "@/config/tabbar.config"

// åº•éƒ¨å¯¼èˆªæ æ•°æ®
const tabList = ref<TabItem[]>(defaultTabList)

// æ ‡ç­¾é¡µæ•°æ®
const tabItems = ref([
  { name: "ä½œå“ â–¼" },
  { name: "æ—¥å¸¸" },
  { name: "æ¨è" },
  { name: "æ”¶è—" },
  { name: "å–œæ¬¢" },
])

// ä½œå“æ•°æ®
const works = ref([
  {
    id: 1,
    cover: "https://cdn.pixabay.com/photo/2019/10/29/14/46/landscape-4587079_1280.jpg",
    views: 10000,
    isAI: true,
    location: "",
  },
  {
    id: 2,
    cover: "https://cdn.pixabay.com/photo/2019/11/08/11/56/kitten-4611189_1280.jpg",
    views: 1999,
    isAI: false,
    location: "",
  },
  {
    id: 3,
    cover: "https://cdn.pixabay.com/photo/2016/11/29/09/32/auto-1868726_1280.jpg",
    views: 0,
    isAI: false,
    location: "å¤ªåŸçš„æ™šé«˜å³°æœ‰å¤šå µ",
  },
])

// å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢
const handleTabChange = (index: number) => {
  console.log("å½“å‰æ ‡ç­¾é¡µ:", index)
}

// å¯¼èˆªåˆ°ç§å¯†ä½œå“
const navigateToPrivateWorks = () => {
  uni.navigateTo({
    url: "/pages-sub/private-works/index",
  })
}

// å¯¼èˆªåˆ°è‰ç¨¿ç®±
const navigateToDrafts = () => {
  uni.navigateTo({
    url: "/pages-sub/drafts/index",
  })
}

// æ‰“å¼€è§†é¢‘è¯¦æƒ…
const openVideoDetail = (work: any) => {
  uni.navigateTo({
    url: `/pages-sub/video-detail/index?id=${work.id}`,
  })
}

// æ ¼å¼åŒ–æ•°å­—
const formatCount = (count: number): string => {
  if (count < 1000) return count.toString()
  if (count < 10000) return (count / 1000).toFixed(1) + "k"
  return (count / 10000).toFixed(1) + "w"
}

// å¤„ç†åº•éƒ¨å¯¼èˆªæ åˆ‡æ¢
const handleTabbarChange = (index: number, item: any) => {
  console.log("åˆ‡æ¢åˆ°:", item.text, item.path)
}
</script>
